<!-- index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Playback "Demo" - text one word at a time</title>
</head>
<body>

	Just in the console at the moment.


	<script src="node_modules/@knod/hyphenaxe/lib/hyphenaxe.js"></script>
	<script src="node_modules/@knod/prose-stepper/dist/prose-stepper.js"></script>
	<script src="node_modules/@knod/string-time/dist/string-time.js"></script>
	<script src="dist/playback.js"></script>
	<script src="node_modules/wolfy87-eventemitter/EventEmitter.js"></script>

	<script>

		var state = {};

		state.emitter = new EventEmitter();  // Now has events
		state.stepper = { maxNumCharacters: 20 };
		state.delayer = { slowStartDelay: 0 };
		state.playback = {};
		// state.playback.transformFragment = function ( frag ) {
		// 	var changed = frag.replace(/[\n\r]+/g, '$@skip@$');
		// 	return changed;
		// }

		const skippers = [ 'Victorious,', 'flag.', 'Delirious,', 'come', '\n', 'wattlebird?' ];
		state.playback.transformFragment = function ( frag ) {
			if ( skippers.indexOf(frag) > -1 ) {
				return '$@skip@$'
			} else {
				return frag;
			}
		}

		var parsedText = [
			[ 'Victorious,', 'you','brave', 'flag.' ],
			[ 'Delirious,', 'I', 'come', 'back.' ],
			[ '\n' ],
			[ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ],
			// [ 'Victorious,', 'you','brave', 'flag.' ],
			// [ 'Delirious,', 'I', 'come', 'back.' ],
			// [ '\n' ],
			// [ 'Why,', 'oh', 'wattlebird?' ]
		];

		var playback = Playback( state );
		var plab 	 = playback;  // For console convenience

		playback.process( parsedText );

		// state.emitter.on('newWordFragment', function (playback, frag) {
		// 	console.log( 'newFrag:', frag );
		// });

		state.emitter.on('loopSkip', function (playback, frag) {
			console.log( 'newFrag:', frag );
		});

		playback.play();

		// var words, args, result;
		// var runWith = function ( op1, op2, toListenFor, op2Check, msTillAssert, assert, debug ) {
		// /*
		// * 
		// * `op1()` - initial function called at start
		// * `op2()` - function called later in the `toListenFor` event
		// * `toListenFor` - String name of event that will be listened for
		// * 	and in which `op2Check()` and `op2()` will be run
		// * `op2Check()` - should return Bool, ready to trigger opt2 or not,
		// * 	will be given the `Playback` instance
		// * `msTillAssert` - how long to let the events run before running the
		// * 	assertion
		// * `assert()` - will be given the `Playback` instance and an object
		// * 	containing 1) all fragments collected 2) lists of all lists of
		// * 	arguments collected
		// * `debug` - option to trigger debug logs (in here or in `op`s)
		// * 
		// * ??: Add 'doneCheck' for an optional function to check if it's time
		// * 	to call done early?
		// */

		// 	msTillAssert = msTillAssert || 0;

		// 	// // This is the beforeEach function
		// 	// beforeEach(function () {
		// 	frags = [], args = [], result = { frags: frags, args: args };

		// 	plab.reset();

		// 	var count = 0;
		// 	var whenRun = function ( arg1, arg2, arg3, arg4 ) {

		// 		if ( op2Check && op2Check( playback ) ) {
		// 			if ( op2 ) { playback[ op2 ]( debug ); }
		// 		}

		// 		// I happen to know this will be the fragment some of the time
		// 		// and, most of the time it'll be the argument I'm interested in.
		// 		frags.push( arg2 );
		// 		args.push( [ arg1, arg2, arg3, arg4 ] );

		// 		// arg1 is always the `Playback` instance
		// 		if ( debug ) { console.log( '`.' + op1 + '()`', 'then', '`.' + op2 + '()`', 'in', '"' + toListenFor + '"', 'results in a `Playback` instance and:', arg2, ',', arg3, ', and', arg4 ); }

		// 		// if ( prop ) { console.log( 'property', prop, '=', playback[prop] ) }
		// 	}

		// 	state.emitter.on( toListenFor, whenRun );

		// 	playback[ op1 ]( debug );

		// 	// , msTillAssert )};  // Add msTillAssert here

		// 	var runAssert = function () {
		// 		state.emitter.off( toListenFor, whenRun );
		// 		if ( assert ) { assert( playback, result ) }
		// 	};

		// 	setTimeout( runAssert, msTillAssert );
			
		// };

		// var assert = function( plbk, result ) {
		// 	var allTrue = false;
		// 	// After getting to the end, this should be paused
		// 	if ( plbk._persistentAction === 'play' ) { allTrue = false; }
		// 	else { allTrue = true; }

		// 	console.log( 'All tests passed:', plbk._persistentAction, allTrue, result );
		// }

		// runWith( 'play', 'play', 'newWordFragment', function () { return true; }, 1000, assert, true );

	</script>
	
</body>
</html>
